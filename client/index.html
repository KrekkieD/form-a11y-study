<!DOCTYPE html>
<html>
    <head>

        <script>
            /* Here be IE8 polyfills */
            if (!Array.isArray) {
                Array.isArray = function(arg) {
                    return Object.prototype.toString.call(arg) === '[object Array]';
                };
            }
            if (!Array.prototype.indexOf) {
                Array.prototype.indexOf = function(searchElement, fromIndex) {

                    var k;

                    // 1. Let O be the result of calling ToObject passing
                    //    the this value as the argument.
                    if (this == null) {
                        throw new TypeError('"this" is null or not defined');
                    }

                    var O = Object(this);

                    // 2. Let lenValue be the result of calling the Get
                    //    internal method of O with the argument "length".
                    // 3. Let len be ToUint32(lenValue).
                    var len = O.length >>> 0;

                    // 4. If len is 0, return -1.
                    if (len === 0) {
                        return -1;
                    }

                    // 5. If argument fromIndex was passed let n be
                    //    ToInteger(fromIndex); else let n be 0.
                    var n = +fromIndex || 0;

                    if (Math.abs(n) === Infinity) {
                        n = 0;
                    }

                    // 6. If n >= len, return -1.
                    if (n >= len) {
                        return -1;
                    }

                    // 7. If n >= 0, then Let k be n.
                    // 8. Else, n<0, Let k be len - abs(n).
                    //    If k is less than 0, then let k be 0.
                    k = Math.max(n >= 0 ? n : len - Math.abs(n), 0);

                    // 9. Repeat, while k < len
                    while (k < len) {
                        // a. Let Pk be ToString(k).
                        //   This is implicit for LHS operands of the in operator
                        // b. Let kPresent be the result of calling the
                        //    HasProperty internal method of O with argument Pk.
                        //   This step can be combined with c
                        // c. If kPresent is true, then
                        //    i.  Let elementK be the result of calling the Get
                        //        internal method of O with the argument ToString(k).
                        //   ii.  Let same be the result of applying the
                        //        Strict Equality Comparison Algorithm to
                        //        searchElement and elementK.
                        //  iii.  If same is true, return k.
                        if (k in O && O[k] === searchElement) {
                            return k;
                        }
                        k++;
                    }
                    return -1;
                };
            }
        </script>
        <script src="/static/angularjs/angular.js"></script>
        <!--<script src="/static/angular/angular.js"></script>-->
        <!--<script src="/static/angular-material/angular-material.js"></script>-->
        <script src="/static/angular-aria/angular-aria.js"></script>
        <!--<script src="/static/angular-animate/angular-animate.js"></script>-->
        <script src="/static/angular-messages/angular-messages.js"></script>
        <script src="/app/app.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

        <style>

            *:focus {
                outline: 2px dotted black !important;
            }

            [ng-messages] {
                color: red;
            }

            label {
                display: inline-block;
                min-width: 150px;
            }
            fieldset > div {
                padding: .5em;
            }
            body:not(.accessibility-enabled) .accessibility-content {
                display: none !important;
            }

            [aria-invalid="true"] {
                background-color: #ffa0a0;
            }
            [aria-invalid="false"] {
                background-color: #a0ffa0;
            }
            [ng-form][tabindex="-1"].ng-invalid {
                border: 1px solid red;
            }
            [tabindex="0"] {
                outline: 2px dotted #bbbbbb;
            }

        </style>
    </head>
    <body ng-app="test.app">

        <button ng-click="showOverview = !showOverview">Toggle overview</button>
        <div ng-show="showOverview" ng-include="'/overview.html'"></div>

        <form test-app-form name="formStudy" ng-submit="form.submit(formStudy)" novalidate>

            <!-- top errors -->
            <div id="errors" tabindex="-1">
                <div ng-if="formStudy.$submitted && !formStudy.$valid" style="color: red;">

                    <div ng-messages="formStudy.$error" aria-live="assertive">
                        <div ng-message="internalservererror">
                            <span aria-hidden="true" class="fa fa-exclamation-circle"></span>
                            Something went wrong. Please try again or contact the customer service.
                        </div>
                        <div ng-message="accounttoosimilar">
                            <span aria-hidden="true" class="fa fa-exclamation-circle"></span>
                            There appears to be an identical account using these details. Are you sure you
                            haven't registered before? If so, please confirm your details and try again.
                        </div>
                        <div ng-message="email,emailinuse,required,minlength,pattern,maxlength,phonenotrecognized,addressnotrecognized">
                            <p>
                                <span aria-hidden="true" class="fa fa-exclamation-circle"></span>
                                Please correct the fields marked as invalid
                            </p>
                            <a tabindex="0"
                                href="#"
                                ng-click="form.toggleTabIndex()">

                                <span ng-show="!form.tabIndexOn">Click to focus on errors only</span>
                                <span ng-show="form.tabIndexOn">Click to restore focus to all fields</span>

                            </a>
                            <p aria-live="polite" id="errorfocusenabled">
                                <span ng-if="form.tabIndexOn === true">To cancel error focus, press escape</span>
                                <span ng-if="form.tabIndexOn === false">Form field focus restored</span>
                            </p>
                        </div>
                    </div>

                </div>
            </div>

            <fieldset ng-form="basic">
                <legend>Basic fields</legend>

                <div>

                    <label id="emailLabel">email</label>
                    <input type="email"
                        required
                        name="email"
                        emailinuse
                        ng-model="form.model.email"
                        id="email"
                        tabindex="0"
                        aria-labeledby="emailLabel emailErrorLabel">


                    <div ng-if="formStudy.$submitted || formStudy.basic.email.$dirty"
                        ng-messages="formStudy.basic.email.$error"
                        id="emailErrorLabel"
                        aria-live="assertive">

                        <div ng-message="emailinuse">This email is already in use</div>
                        <div ng-message="required">This is required</div>
                        <div ng-message="email">Please fill in a valid email address</div>
                    </div>
                </div>


                <div>
                    <label id="passwordLabel">password</label>
                    <input type="password"
                        required
                        name="password"
                        minlength="6"
                        ng-pattern="/[^a-zA-Z]+/"
                        ng-model="form.model.password"
                        id="password"
                        tabindex="0"
                        aria-labeledby="passwordLabel passwordErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.basic.password.$dirty"
                        ng-messages="formStudy.basic.password.$error"
                        id="passwordErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                        <div ng-message="minlength">Please use a password of at least 6 characters</div>
                        <div ng-message="pattern">Please use at least one character that is not a-z</div>
                    </div>
                </div>

            </fieldset>
            <fieldset ng-form="phone" tabindex="-1">
                <legend>Phone details</legend>

                <div ng-if="formStudy.$submitted && !formStudy.phone.$valid"
                    id="phoneFormErrors"
                    style="color: red;"
                    ng-messages="formStudy.phone.$error">

                    <p ng-message="phonenotrecognized">
                        <span aria-hidden="true" class="fa fa-exclamation-circle"></span>
                        We were unable to recognize your phone details. Please confirm your details or try again.
                    </p>
                </div>

                <div>
                    <label id="phoneCountryLabel" aria-hidden="true">country prefix</label>
                    <input type="text"
                        ng-pattern="/[0-9]+/"
                        required
                        name="phonePrefix"
                        id="phonePrefix"
                        ng-model="form.model.phone.prefix"
                        tabindex="0"
                        aria-labeledby="phoneCountryLabel phoneCountryErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.phone.phonePrefix.$dirty"
                        ng-messages="formStudy.phone.phonePrefix.$error"
                        id="phoneCountryErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                        <div ng-message="pattern">Please enter only numbers</div>
                    </div>
                </div>


                <div>
                    <label id="phoneNumberLabel" aria-hidden="true">number</label>
                    <input type="text"
                        ng-pattern="/[0-9]+/"
                        required
                        name="phoneNumber"
                        id="phoneNumber"
                        ng-model="form.model.phone.number"
                        tabindex="0"
                        aria-labeledby="phoneNumberLabel phoneNumberErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.phone.phoneNumber.$dirty"
                        ng-messages="formStudy.phone.phoneNumber.$error"
                        id="phoneNumberErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                        <div ng-message="pattern">Please enter only numbers</div>
                    </div>
                </div>


            </fieldset>
            <fieldset ng-form="address" tabindex="-1">
                <legend>Address details</legend>

                <div ng-if="formStudy.$submitted && !formStudy.address.$valid" style="color: red;"
                    ng-messages="formStudy.address.$error">

                    <p ng-message="addressnotrecognized">
                        <span aria-hidden="true" class="fa fa-exclamation-circle"></span>
                        We were unable to recognize your address. Please confirm your details or try again.
                    </p>
                </div>

                <div>
                    <label id="addressCountryCodeLabel">country code</label>
                    <input type="text"
                        ng-pattern="/[a-z]{2}/"
                        maxlength="2"
                        required
                        name="addressCountryCode"
                        id="addressCountryCode"
                        ng-model="form.model.address.countryCode"
                        tabindex="0"
                        aria-labeledby="addressCountryCodeLabel addressCountryCodeErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.address.addressCountryCode.$dirty"
                        ng-messages="formStudy.address.addressCountryCode.$error"
                        id="addressCountryCodeErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                        <div ng-message="pattern, maxlength">Please enter the 2 characters of your country code</div>
                    </div>
                </div>

                <div>
                    <label id="addressStreetLabel">street</label>
                    <input type="text"
                        required
                        name="addressStreet"
                        id="addressStreet"
                        ng-model="form.model.address.street"
                        tabindex="0"
                        aria-labeledby="addressStreetLabel addressStreetErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.address.addressStreet.$dirty"
                        ng-messages="formStudy.address.addressStreet.$error"
                        id="addressStreetErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                    </div>
                </div>

                <div>
                    <label id="addressCityLabel">city</label>
                    <input type="text"
                        required
                        name="addressCity"
                        id="addressCity"
                        ng-model="form.model.address.city"
                        tabindex="0"
                        aria-labeledby="addressCityLabel addressCityErrorLabel">

                    <div ng-if="formStudy.$submitted || formStudy.address.addressCity.$dirty"
                        ng-messages="formStudy.address.addressCity.$error"
                        id="addressCityErrorLabel"
                        aria-live="assertive">

                        <div ng-message="required">This is required</div>
                    </div>
                </div>

            </fieldset>
            <fieldset ng-form="backendErrors">
                <legend>Trigger backend errors</legend>

                <ul>
                    <li>
                        <label>
                            <input type="checkbox" ng-model="form.model.error.internalservererror">
                            backend internal server error (ignores other errors)
                        </label>
                    </li>
                    <li>
                        <label>
                            <input type="checkbox" ng-model="form.model.error.accounttoosimilar">
                            backend account too similar (ignores other errors)
                        </label>
                    </li>
                    <li>
                        <label>
                            <input type="checkbox" ng-model="form.model.error.emailinuse">
                            backend email in use error
                        </label>
                    </li>
                    <li>
                        <label>
                            <input type="checkbox" ng-model="form.model.error.phonenotrecognized">
                            backend phone not recognized error
                        </label>
                    </li>
                    <li>
                        <label>
                            <input type="checkbox" ng-model="form.model.error.addressnotrecognized">
                            backend address not recognized error
                        </label>
                    </li>
                </ul>

            </fieldset>

            <div>
                <input tabindex="0" type="submit" value="submit">
            </div>

        </form>

        <p>Source at <a href="https://github.com/KrekkieD/form-a11y-study/"><span class="fa fa-fw fa-github"></span> Github</a></p>

        <pre>Preview of model obj:<br>{{ form.model | json:4 }}</pre>

    </body>
</html>
